<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Debug Token</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .info { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>üîç Token Debug</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');

        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = msg;
            output.appendChild(div);
        }

        try {
            const token = localStorage.getItem('jecoplus_access_token');
            const refresh = localStorage.getItem('jecoplus_refresh_token');
            const csrf = localStorage.getItem('csrf_token');

            if (!token) {
                log('‚ùå No access token found', 'error');
            } else {
                log('‚úÖ Access token exists: ' + token.substring(0, 50) + '...', 'success');

                // Decode token
                try {
                    const parts = token.split('.');
                    if (parts.length !== 3) {
                        log('‚ùå Invalid JWT format (should have 3 parts)', 'error');
                    } else {
                        const payload = JSON.parse(atob(parts[1]));
                        const header = JSON.parse(atob(parts[0]));

                        log('<div class="info"><strong>Token Header:</strong><br>' + JSON.stringify(header, null, 2) + '</div>');

                        const exp = new Date(payload.exp * 1000);
                        const iat = new Date(payload.iat * 1000);
                        const now = new Date();

                        log('<div class="info"><strong>Token Payload:</strong><br>' +
                            'User ID: ' + payload.sub + '<br>' +
                            'Role: ' + payload.role + '<br>' +
                            'Issued: ' + iat.toLocaleString() + '<br>' +
                            'Expires: ' + exp.toLocaleString() + '<br>' +
                            'Age: ' + Math.floor((now - iat) / 1000 / 60) + ' minutes<br>' +
                            'Status: ' + (exp < now ? '‚ùå EXPIRED' : '‚úÖ Valid') +
                            '</div>');

                        if (exp < now) {
                            log('‚ö†Ô∏è Token has expired ' + Math.floor((now - exp) / 1000 / 60) + ' minutes ago', 'error');
                        }
                    }
                } catch (e) {
                    log('‚ùå Cannot decode token: ' + e.message, 'error');
                }
            }

            if (refresh) {
                log('‚úÖ Refresh token exists', 'success');
            } else {
                log('‚ùå No refresh token', 'error');
            }

            if (csrf) {
                log('‚úÖ CSRF token exists: ' + csrf.substring(0, 30) + '...', 'success');
            }

        } catch (err) {
            log('‚ùå Error: ' + err.message, 'error');
        }
    </script>
</body>
</html>
